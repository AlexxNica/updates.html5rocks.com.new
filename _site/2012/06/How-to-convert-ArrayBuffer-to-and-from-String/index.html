<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta property="twitter:account_id" content="1593210261" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A resource for developers looking to put HTML5 to use today, including information on specific features and when to use them in your apps.">
<meta name="keywords" content="html5,html 5,html5 demos,html5 examples,javascript,css3,notifications,geolocation,web workers,apppcache,file api,filereader,indexeddb,offline,audio,video,drag and drop,chrome,sse,mobile">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="E1HOIDkksrWY5npenL8FeQhKn4Ujctd75iO2lfufSyA" />
<title>How to convert ArrayBuffer to and from String</title>

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="  /assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png">
<meta name="theme-color" content="#3372DF">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="HTML5 Rocks">
<link rel="apple-touch-icon-precomposed" href="/assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png
">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/assets/HTML5_Badge_144-ddcf1cea1a1204b1733041733d66f76a.png
">
<meta name="msapplication-TileColor" content="#3372DF">

<!-- TODO: consider rel=canonical -->
<link rel="alternate" type="application/rss+xml" title="HTML5 Rocks RSS" href="http://feeds.feedburner.com/html5rocks">
<link rel="publisher" href="https://plus.google.com/+GoogleChromeDevelopers">

  
    
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ChromiumDev">
<meta name="twitter:creator" content="@renatomangini">

<meta property="og:type" content="article">
<meta property="og:title" content="How to convert ArrayBuffer to and from String - HTML5 Rocks">
<meta property="og:url" content="/2012/06/How-to-convert-ArrayBuffer-to-and-from-String">
<meta property="og:description" content="How to convert ArrayBuffer to and from String">
<meta property="og:image" content="http://www.html5rocks.com/static/images/profiles/renatomangini.png">
<meta property="og:site_name" content="HTML5 Rocks - A resource for open web HTML5 developers">

<link rel="author" href="https://www.google.com/profiles/102180419759627664875">
  

<link href="//fonts.googleapis.com/css?family=Open+Sans:600,800|Source+Code+Pro" rel="stylesheet">
<link rel="stylesheet" href="/assets/main-8dae1b06ec239bb8b24c3d98cd1ad04b.css">

<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5-els.js"></script>
<![endif]-->

  </head>
  <body>
    <header class="main" id="siteheader">
  <a href="#sitenav" id="navtoggle"></a>
  <nav id="sitenav" class="container">
    <ul>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com" class="tutorials">Home</a>
      </li>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com/en/tutorials/?page=1" class="tutorials">Tutorials</a>
      </li>
      <li id="updates_menu">
        <a href="http://www.html5rocks.com/en/updates" class="updates">Updates</a>
      </li>
      <li id="contrib_menu">
        <a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
      </li>
      <li id="slides_menu">
        <a href="http://www.html5rocks.com/en/slides" class="slides">Slides</a>
      </li>
      <li id="resources_menu">
        <a href="http://www.html5rocks.com/en/resources" class="resources">Resources</a>
      </li>
    </ul>
  </nav>
</header>

    <div class="body-content">
      <section class="banner">
        <section class="container">
          <a href="/" class="watermark"></a>
          <h1>How to convert ArrayBuffer to and from String</h1>
          
        </section>
      </section>
      <article class="content-wrapper article">
<div class="container">
  <section class="byline clearfix">
    <section class="author-images">
      
        
<!-- TODO: change image address.-->

<img src="http://www.html5rocks.com/static/images/profiles/renatomangini.png"
     alt="Renato Mangini"
     title="Renato Mangini"
     width="60" height="60"
     class="avatar">



      
    </section>
    <section class="meta">
      <div class="authors">
          
    
    <!-- TODO: change link. -->
    <strong>By</strong> <a href="http://www.html5rocks.com/profiles/#renatomangini">
      Renato Mangini
    </a> 
  

      </div>
      <div class="published">
        <time pubdate=""><strong>Published:</strong> June 15, 2012</time>
      </div>
      <div class="updated">
        <time><strong>Updated:</strong> June 15, 2012</time>
      </div>
      <div class="comments">
        <span><strong>Comments:</strong> <a href="#disqus_thread" class="load-comments" data-disqus-identifier="http://updates.html5rocks.com/2012/06/How-to-convert-ArrayBuffer-to-and-from-String">0</a></span>
      </div>
      <div id="notcompatible" class="hidden">
        Your browser may not support the functionality in this article.
      </div>
    </section>
  </section>
  <section class="content">
    <p>ArrayBuffers are used to transport raw data and several new APIs rely on them, including <a href="http://www.html5rocks.com/en/tutorials/websockets/basics/">WebSockets</a>, <a href="http://webintents.org">Web Intents</a>, <a href="http://www.html5rocks.com/en/tutorials/file/xhr2/">XMLHttpRequest version 2</a> and <a href="http://www.html5rocks.com/en/tutorials/workers/basics/#toc-gettingstarted-workercomm">WebWorkers</a>. However, because they recently landed in the JavaScript world, sometimes they are misinterpreted or misused.</p>

<p>Semantically, an <a href="https://developer.mozilla.org/en/JavaScript_typed_arrays/ArrayBuffer">ArrayBuffer</a> is simply an array of bytes viewed through a specific mask. This mask, an instance of <a href="https://developer.mozilla.org/en/JavaScript_typed_arrays/ArrayBufferView">ArrayBufferView</a>, defines how bytes are aligned to match the expected structure of the content. For example, if you know that the bytes in an ArrayBuffer represent an array of 16-bit unsigned integers, you just wrap the ArrayBuffer in a <code>Uint16Array</code> view and you can manipulate its elements using the brackets syntax as if the <code>Uint16Array</code> was an integer array:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// suppose buf contains the bytes [0x02, 0x01, 0x03, 0x07]</span>
<span class="c1">// notice the multibyte values respect the hardware endianess, which is little-endian in x86</span>
<span class="kd">var</span> <span class="nx">bufView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">bufView</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="mi">258</span><span class="p">)</span> <span class="p">{</span>   <span class="c1">// 258 === 0x0102</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">bufView</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>    <span class="c1">// buf now contains the bytes [0xFF, 0x00, 0x03, 0x07]</span>
<span class="nx">bufView</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff05</span><span class="p">;</span> <span class="c1">// buf now contains the bytes [0x05, 0xFF, 0x03, 0x07]</span>
<span class="nx">bufView</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0210</span><span class="p">;</span> <span class="c1">// buf now contains the bytes [0x05, 0xFF, 0x10, 0x02]</span></code></pre></div>

<p>One common practical question about ArrayBuffer is how to convert a <code>String</code> to an <code>ArrayBuffer</code> and vice-versa. Since an ArrayBuffer is, in fact, a byte array, this conversion requires that both ends agree on how to represent the characters in the String as bytes. You probably have seen this “agreement” before: it is the String’s character encoding (and the usual “agreement terms” are, for example, Unicode UTF-16 and iso8859-1). Thus, supposing you and the other party have agreed on the UTF-16 encoding, the conversion code could be something like:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ab2str</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">));</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">str2ab</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// 2 bytes for each char</span>
  <span class="kd">var</span> <span class="nx">bufView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">strLen</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span> <span class="nx">strLen</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bufView</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">buf</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>Note the use of <code>Uint16Array</code>. This is an ArrayBuffer view that aligns bytes of the ArrayBuffers as 16-bit elements. It doesn’t handle the character encoding itself, which is handled as Unicode by <code>String.fromCharCode</code> and <code>str.charCodeAt</code>.</p>

<p>Note: A robust implementation of the String to ArrayBuffer conversion capable of handling more encodings is provided by <a href="http://code.google.com/p/stringencoding/">the stringencoding library</a>. But, for simple usage where you control both sides of the communication pipe, the code above is probably enough. A standardized API specification for String encoding <a href="http://wiki.whatwg.org/wiki/StringEncoding">is being drafted </a><a href="http://wiki.whatwg.org/wiki/StringEncoding">by the WHATWG</a> working group.</p>

<p>A popular StackOverflow <a href="http://stackoverflow.com/questions/6965107/converting-between-strings-and-arraybuffers">question about this</a> has a highly voted answer with a somewhat convoluted solution to the conversion: create a <code>FileReader</code> to act as a converter and feed a <code>Blob</code> containing the String into it. Although this method works, it has poor readability and I suspect it is slow. Since unfounded suspicions have driven many mistakes in the history of humanity, let’s take a more scientific approach here. I have <a href="http://jsperf.com/arraybuffer-string-conversion/4">jsperf’ed the two methods</a> and the result confirms my suspicion:</p>

<iframe style="width: 100%; height: 340px; overflow: hidden; border: 0;" src="http://www.html5rocks.com/en/tutorials/canvas/performance/embed.html?id=agt1YS1wcm9maWxlcnINCxIEVGVzdBixrYIRDA"></iframe>

<p>In Chrome 20, it is almost 27 times faster to use the direct <code>ArrayBuffer</code> manipulation code on this article than it is to use the <code>FileReader</code>/<code>Blob</code> method.</p>

<p><strong>Update, August 2014</strong>: The Encoding API specification has matured, and a number of browsers now support it natively. The information in this article still applies for browsers that don’t yet support the Encoding API, but the recommended approach is to use the official API wherever possible. See <a href="http://updates.html5rocks.com/2014/08/Easier-ArrayBuffer---String-conversion-with-the-Encoding-API">Easier ArrayBuffer &lt;-&gt; String conversion with the Encoding API</a> for more details.</p>

  </section>
  <section>
    <!-- TODO: Update link. -->
    
      <a href="/tag/performance" class="tag">performance</a>
    
      <a href="/tag/ArrayBuffer" class="tag">ArrayBuffer</a>
    
      <a href="/tag/nuts_and_bolts" class="tag">nuts and bolts</a>
    
  </section>
  <div class="pager">
    
    <a href="/2012/06/Don-t-Build-Blobs-Construct-Them">&laquo; Don't Build Blobs, Construct Them</a>
     | 
    <a href="/2012/06/The-amazing-powers-of-CSS">The amazing powers of CSS &raquo;</a>
    
  </div>
</div>
</article>
<section class="disqus pattern-bg-lighter">
  <div id="disqus" class="container">
    <h2>Comments</h2>
    <div id="disqus_thread">
      <a href="#disqus_thread" class="load-comments"
          data-disqus-identifier="http://updates.html5rocks.com/2012/06/How-to-convert-ArrayBuffer-to-and-from-String">0</a>
    </div>
  </div>

  <noscript>
    <p class="center">
      <strong>
        <a href="http://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a>
      </strong>
    </p>
  </noscript>

  <script>

    var disqus_shortname = 'html5rocks';
    var disqus_identifier = 'http://updates.html5rocks.com/2012/06/How-to-convert-ArrayBuffer-to-and-from-String';
    var disqus_url = 'http://updates.html5rocks.com/2012/06/How-to-convert-ArrayBuffer-to-and-from-String';
    var disqus_developer = 0;

    var disqus_config = function () {
      var funky_language_code_mapping = {
        'de': 'de_inf',
        'es': 'es_ES',
        'pt': 'pt_EU',
        'sr': 'sr_CYRL',
        'sv': 'sv_SE',
        'zh': 'zh_HANT'
      };
      this.language = funky_language_code_mapping['en'] ||
                      'en';

      this.callbacks.onReady = [ function () {
                                    try {
                                      ga('send', 'event', 'View comments');
                                    } catch(err){}
                                 } ];
      this.callbacks.onNewComment = [ function (comment) {
                                        try {
                                          ga('send', 'event', 'Commented');
                                        } catch(err){}
                                      } ];
    };

    window.addEventListener('load', function(e) {

      var c = document.createElement('script');
      c.type = 'text/javascript';
      c.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      c.async = true;

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      sp.insertBefore(c, s);

      if (window.location.hash === '#disqus_thread')
        loadComments();

    }, false);

    var disqus_loaded = false;
    function loadComments() {

      if (disqus_loaded)
        return;

      disqus_loaded = true;

      ga('send', 'event', 'Interactions', 'Comments', 'Comments Loaded');

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;

      var disqusContainer = document.getElementById('disqus');
      disqusContainer.classList.add('active');

      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      sp.insertBefore(dsq, s);
    }
    var loadCommentsButtons = document.querySelectorAll('.load-comments');
    for(var l = 0; l < loadCommentsButtons.length; l++)
      loadCommentsButtons[l].addEventListener('click', loadComments);

  </script>
</section>



    </div>
    <footer>
  <div class="container">
    
    <h1>Next steps</h1>
    <aside class="panel share">
      <h2>Share</h2>
        <a href="https://twitter.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/&amp;text=Getting Started with CSS Shapes&amp;lang=en&amp;via=ChromiumDev&amp;related=ChromiumDev" class="twitter" target="_blank">Twitter</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="facebook" target="_blank">Facebook</a>
        <a href="https://plus.google.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="gplus" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">Google+</a>
    </aside>
    <aside class="panel rss">
      <h2>Subscribe</h2>
      <p>Enjoyed this article? Grab the <a href="http://feeds.feedburner.com/html5rocks">RSS feed</a> and stay up-to-date.</p>
    </aside>
    
    <p class="licensing">
      Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
    </p>
  </div>
</footer>


    <script>
      (function() {

        var siteHeader = document.getElementById('siteheader');
        var navToggle = document.getElementById('navtoggle');
        var siteNav = document.getElementById('sitenav');

        navToggle.addEventListener('click', function(e) {
          siteNav.classList.toggle('active');
          e.preventDefault();
        });

      })();
    </script>

    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create','UA-15028909-7','auto');
      ga('create','UA-49880327-4','auto',{'name':'html5rocks'});
      ga('send','pageview');
      ga('html5rocks.send','pageview');
    </script>
  </body>
</html>
