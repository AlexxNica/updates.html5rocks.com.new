<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta property="twitter:account_id" content="1593210261" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A resource for developers looking to put HTML5 to use today, including information on specific features and when to use them in your apps.">
<meta name="keywords" content="html5,html 5,html5 demos,html5 examples,javascript,css3,notifications,geolocation,web workers,apppcache,file api,filereader,indexeddb,offline,audio,video,drag and drop,chrome,sse,mobile">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="E1HOIDkksrWY5npenL8FeQhKn4Ujctd75iO2lfufSyA" />
<title>Canvas-driven background images</title>

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="  /assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png">
<meta name="theme-color" content="#3372DF">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="HTML5 Rocks">
<link rel="apple-touch-icon-precomposed" href="/assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png
">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/assets/HTML5_Badge_144-ddcf1cea1a1204b1733041733d66f76a.png
">
<meta name="msapplication-TileColor" content="#3372DF">

<!-- TODO: consider rel=canonical -->
<link rel="alternate" type="application/rss+xml" title="HTML5 Rocks RSS" href="http://feeds.feedburner.com/html5rocks">
<link rel="publisher" href="https://plus.google.com/+GoogleChromeDevelopers">

  
    
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ChromiumDev">
<meta name="twitter:creator" content="@ebidel">

<meta property="og:type" content="article">
<meta property="og:title" content="Canvas-driven background images - HTML5 Rocks">
<meta property="og:url" content="/2012/12/Canvas-driven-background-images">
<meta property="og:description" content="Powering a css background using canvas or webgl">
<meta property="og:image" content="http://www.html5rocks.com/static/images/profiles/ericbidelman.png">
<meta property="og:site_name" content="HTML5 Rocks - A resource for open web HTML5 developers">

<link rel="author" href="https://www.google.com/profiles/118075919496626375791">
  

<link href="//fonts.googleapis.com/css?family=Open+Sans:600,800|Source+Code+Pro" rel="stylesheet">
<link rel="stylesheet" href="/assets/main-8dae1b06ec239bb8b24c3d98cd1ad04b.css">

<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5-els.js"></script>
<![endif]-->

  </head>
  <body>
    <header class="main" id="siteheader">
  <a href="#sitenav" id="navtoggle"></a>
  <nav id="sitenav" class="container">
    <ul>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com" class="tutorials">Home</a>
      </li>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com/en/tutorials/?page=1" class="tutorials">Tutorials</a>
      </li>
      <li id="updates_menu">
        <a href="http://www.html5rocks.com/en/updates" class="updates">Updates</a>
      </li>
      <li id="contrib_menu">
        <a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
      </li>
      <li id="slides_menu">
        <a href="http://www.html5rocks.com/en/slides" class="slides">Slides</a>
      </li>
      <li id="resources_menu">
        <a href="http://www.html5rocks.com/en/resources" class="resources">Resources</a>
      </li>
    </ul>
  </nav>
</header>

    <div class="body-content">
      <section class="banner">
        <section class="container">
          <a href="/" class="watermark"></a>
          <h1>Canvas-driven background images</h1>
          
        </section>
      </section>
      <article class="content-wrapper article">
<div class="container">
  <section class="byline clearfix">
    <section class="author-images">
      
        
<!-- TODO: change image address.-->

<img src="http://www.html5rocks.com/static/images/profiles/ericbidelman.png"
     alt="Eric Bidelman"
     title="Eric Bidelman"
     width="60" height="60"
     class="avatar">



      
    </section>
    <section class="meta">
      <div class="authors">
          
    
    <!-- TODO: change link. -->
    <strong>By</strong> <a href="http://www.html5rocks.com/profiles/#ericbidelman">
      Eric Bidelman
    </a> 
  

      </div>
      <div class="published">
        <time pubdate=""><strong>Published:</strong> December 12, 2012</time>
      </div>
      <div class="updated">
        <time><strong>Updated:</strong> December 12, 2012</time>
      </div>
      <div class="comments">
        <span><strong>Comments:</strong> <a href="#disqus_thread" class="load-comments" data-disqus-identifier="http://updates.html5rocks.com/2012/12/Canvas-driven-background-images">0</a></span>
      </div>
      <div id="notcompatible" class="hidden">
        Your browser may not support the functionality in this article.
      </div>
    </section>
  </section>
  <section class="content">
    <h3 id="programmatically-animating-background-images">Programmatically animating background images</h3>

<p>There are two <strong>primary ways people animate background images</strong>:</p>

<ol>
  <li>Use CSS sprites to update a <code>background-position</code> in JS .</li>
  <li>Hacks with <code>.toDataURL()</code> .</li>
</ol>

<p>The first works great if you have the image ahead of time, but what if your source needs to be programmatically generated, say, by a <code>&lt;canvas&gt;</code>? The solution to #1 is to use <code>.toDataURL()</code> on the canvas and set the background to the generated URL:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s1">&#39;image/jpeg&#39;</span><span class="p">);</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;url(&#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>There are two problems with this:</p>

<ol>
  <li><code>data:</code> URLs add a ~33% size overhead to the resulting image.</li>
  <li>A ton of DOM touching (<code>el.style</code>).</li>
</ol>

<p><em>Both of these methods are inefficient: unacceptable for an always-silky-smooth 60fps web app.</em></p>

<h3 id="using-2d-canvas-as-a-background">Using 2d canvas as a background</h3>

<figure style="text-align: center;font-weight:bold;font-size:20px">
<a href="http://html5-demos.appspot.com/static/css/webkit-canvas.html"><img src="/images/AMIfv96Uz9loUuqbn71jF6nv0Q1SbcvG5ltNxZP0At9YEUVd6pt7tTO_k-elVYi2wjiU7MEVPODfytg6UlJI_uAR93po9tMiO8q5br-dEFJbEPGcyfsIdoiaXKaUo1skrJ8N1wBNR7IUFF1aKXyOXgqAKwO3U6xhjw" /></a>
<figcaption><a href="http://html5-demos.appspot.com/static/css/webkit-canvas.html">DEMO</a></figcaption>
</figure>

<p>Turns out, there’s a non-standard API which WebKit has had <a href="https://www.webkit.org/blog/176/css-canvas-drawing/">for years</a> that can take canvas as the source for a background. <em>Sadly however, there’s no published spec for this feature</em>.</p>

<p>First, instead of specifying a URL for the back:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.bg</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="sx">url(bg.png)</span> <span class="k">no-repeat</span> <span class="m">50%</span> <span class="m">50%</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>use <code>-webkit-canvas()</code>, referencing a string identifier to a canvas context:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.canvas-bg</span> <span class="p">{</span>
  <span class="k">background</span><span class="o">:</span> <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">canvas</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span> <span class="k">no-repeat</span> <span class="m">50%</span> <span class="m">50%</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>Next, we need to create the 2d context with a special version of <code>.getContext()</code>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getCSSCanvasContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">,</span> <span class="s1">&#39;animation&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span></code></pre></div>

<p>Note: this method is on the <code>document</code> object and not the canvas. The second argument is the same name used in <code>-webkit-canvas()</code>.</p>

<p>Further <a href="https://www.webkit.org/blog/176/css-canvas-drawing/">information</a> from Dave Hyatt:</p>

<blockquote>
  <p>There is only one CSS canvas for a given global identifier per document. When you obtain the drawing context you also specify the size. The canvas will not be cleared as long as you repeatedly request the same size. Specifying a new size is equivalent to the kind of behavior you’d expect if you resized a <code>&lt;canvas&gt;</code> element, and so the canvas buffer will be cleared.</p>
</blockquote>

<blockquote>
  <p>All objects that observe a CSS canvas of the same name are sharing that canvas. This means that (similar to how animated GIFs work), you can do animations and have them happen in lockstep on all the clients of the canvas. Drawing changes will be propagated to all clients automatically.</p>
</blockquote>

<p><strong>Animations</strong></p>

<p>As seen in the demo, we can reuse <code>requestAnimationFrame()</code> to drive an animation. This is great, because once things are hooked up, <strong>the association between CSS and the canvas element is preserved</strong>. There’s no need to fiddle with the DOM.</p>

<p><em>Demo not animated in Chrome?</em></p>

<p>The current stable channel of Chrome (version 23) has <a href="http://crbug.com/161699">crbug.com/161699</a>, which prevents a <code>requestAnimationFrame()</code> animation from updating the background properly. This has been fixed in Chrome 25 (currently Canary). The <a href="a href=&quot;http://html5-demos.appspot.com/static/css/webkit-canvas.html&quot;">demo</a> also should work well in the current Safari.</p>

<p><strong>Performance benefits</strong></p>

<p>We’re talking canvas here. <strong>Hardware accelerated animations</strong> are now fully in play (at least for the browsers this feature works in). And just to reiterate, <strong>there’s no need to molest the DOM</strong> from JS.</p>

<h3 id="using-webgl-as-a-background">Using webgl as a background</h3>

<p>Hold on a sec. Does this mean we can power a CSS background using webgl? Of course it does! WebGL is merely a 3d context for canvas. Just swap in “experimental-webgl” instead of “2d”, and voila.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getCSSCanvasContext</span><span class="p">(</span><span class="s1">&#39;experimental-webgl&#39;</span><span class="p">,</span> <span class="s1">&#39;animation&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">150</span><span class="p">);</span></code></pre></div>

<p>Here’s a proof of concept that contains a div with it’s background drawn using vertext and fragment shaders: <a href="http://jsbin.com/odimig/269/edit">DEMO</a></p>

<h3 id="other-approaches">Other approaches</h3>

<p>It’s worth noting that Mozilla has had <code>-moz-element()</code> (<a href="https://developer.mozilla.org/en-US/docs/CSS/element">MDN</a>) for quite some time. This is part of the <a href="http://dev.w3.org/csswg/css4-images/#element-notation">CSS Image Values and Replaced Content Module Level 4</a> spec and allows you to create an image generated from arbitrary HTML: videos, canvas, DOM content,…you name it. However, there are security concerns with having full access to snapshot images of the DOM. This is primarily why other browsers have not adopted said feature.</p>

  </section>
  <section>
    <!-- TODO: Update link. -->
    
      <a href="/tag/nuts_and_bolts" class="tag">nuts and bolts</a>
    
      <a href="/tag/canvas" class="tag">canvas</a>
    
      <a href="/tag/CSS" class="tag">CSS</a>
    
      <a href="/tag/graphics" class="tag">graphics</a>
    
  </section>
  <div class="pager">
    
    <a href="/2012/12/WebRTC-hits-Firefox-Android-and-iOS">&laquo; WebRTC hits Firefox, Android and iOS</a>
     | 
    <a href="/2012/12/Screensharing-with-WebRTC">Screensharing with WebRTC &raquo;</a>
    
  </div>
</div>
</article>
<section class="disqus pattern-bg-lighter">
  <div id="disqus" class="container">
    <h2>Comments</h2>
    <div id="disqus_thread">
      <a href="#disqus_thread" class="load-comments"
          data-disqus-identifier="http://updates.html5rocks.com/2012/12/Canvas-driven-background-images">0</a>
    </div>
  </div>

  <noscript>
    <p class="center">
      <strong>
        <a href="http://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a>
      </strong>
    </p>
  </noscript>

  <script>

    var disqus_shortname = 'html5rocks';
    var disqus_identifier = 'http://updates.html5rocks.com/2012/12/Canvas-driven-background-images';
    var disqus_url = 'http://updates.html5rocks.com/2012/12/Canvas-driven-background-images';
    var disqus_developer = 0;

    var disqus_config = function () {
      var funky_language_code_mapping = {
        'de': 'de_inf',
        'es': 'es_ES',
        'pt': 'pt_EU',
        'sr': 'sr_CYRL',
        'sv': 'sv_SE',
        'zh': 'zh_HANT'
      };
      this.language = funky_language_code_mapping['en'] ||
                      'en';

      this.callbacks.onReady = [ function () {
                                    try {
                                      ga('send', 'event', 'View comments');
                                    } catch(err){}
                                 } ];
      this.callbacks.onNewComment = [ function (comment) {
                                        try {
                                          ga('send', 'event', 'Commented');
                                        } catch(err){}
                                      } ];
    };

    window.addEventListener('load', function(e) {

      var c = document.createElement('script');
      c.type = 'text/javascript';
      c.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      c.async = true;

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      sp.insertBefore(c, s);

      if (window.location.hash === '#disqus_thread')
        loadComments();

    }, false);

    var disqus_loaded = false;
    function loadComments() {

      if (disqus_loaded)
        return;

      disqus_loaded = true;

      ga('send', 'event', 'Interactions', 'Comments', 'Comments Loaded');

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;

      var disqusContainer = document.getElementById('disqus');
      disqusContainer.classList.add('active');

      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      sp.insertBefore(dsq, s);
    }
    var loadCommentsButtons = document.querySelectorAll('.load-comments');
    for(var l = 0; l < loadCommentsButtons.length; l++)
      loadCommentsButtons[l].addEventListener('click', loadComments);

  </script>
</section>



    </div>
    <footer>
  <div class="container">
    
    <h1>Next steps</h1>
    <aside class="panel share">
      <h2>Share</h2>
        <a href="https://twitter.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/&amp;text=Getting Started with CSS Shapes&amp;lang=en&amp;via=ChromiumDev&amp;related=ChromiumDev" class="twitter" target="_blank">Twitter</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="facebook" target="_blank">Facebook</a>
        <a href="https://plus.google.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="gplus" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">Google+</a>
    </aside>
    <aside class="panel rss">
      <h2>Subscribe</h2>
      <p>Enjoyed this article? Grab the <a href="http://feeds.feedburner.com/html5rocks">RSS feed</a> and stay up-to-date.</p>
    </aside>
    
    <p class="licensing">
      Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
    </p>
  </div>
</footer>


    <script>
      (function() {

        var siteHeader = document.getElementById('siteheader');
        var navToggle = document.getElementById('navtoggle');
        var siteNav = document.getElementById('sitenav');

        navToggle.addEventListener('click', function(e) {
          siteNav.classList.toggle('active');
          e.preventDefault();
        });

      })();
    </script>

    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create','UA-15028909-7','auto');
      ga('create','UA-49880327-4','auto',{'name':'html5rocks'});
      ga('send','pageview');
      ga('html5rocks.send','pageview');
    </script>
  </body>
</html>
