<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta property="twitter:account_id" content="1593210261" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A resource for developers looking to put HTML5 to use today, including information on specific features and when to use them in your apps.">
<meta name="keywords" content="html5,html 5,html5 demos,html5 examples,javascript,css3,notifications,geolocation,web workers,apppcache,file api,filereader,indexeddb,offline,audio,video,drag and drop,chrome,sse,mobile">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="E1HOIDkksrWY5npenL8FeQhKn4Ujctd75iO2lfufSyA" />
<title>Screensharing with WebRTC</title>

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="  /assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png">
<meta name="theme-color" content="#3372DF">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="HTML5 Rocks">
<link rel="apple-touch-icon-precomposed" href="/assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png
">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/assets/HTML5_Badge_144-ddcf1cea1a1204b1733041733d66f76a.png
">
<meta name="msapplication-TileColor" content="#3372DF">

<!-- TODO: consider rel=canonical -->
<link rel="alternate" type="application/rss+xml" title="HTML5 Rocks RSS" href="http://feeds.feedburner.com/html5rocks">
<link rel="publisher" href="https://plus.google.com/+GoogleChromeDevelopers">

  
    
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ChromiumDev">
<meta name="twitter:creator" content="@sw12">

<meta property="og:type" content="article">
<meta property="og:title" content="Screensharing with WebRTC - HTML5 Rocks">
<meta property="og:url" content="/2012/12/Screensharing-with-WebRTC">
<meta property="og:description" content="">
<meta property="og:image" content="http://www.html5rocks.com/static/images/profiles/dutton.png">
<meta property="og:site_name" content="HTML5 Rocks - A resource for open web HTML5 developers">

<link rel="author" href="https://www.google.com/profiles/104758683354871067458">
  

<link href="//fonts.googleapis.com/css?family=Open+Sans:600,800|Source+Code+Pro" rel="stylesheet">
<link rel="stylesheet" href="/assets/main-8dae1b06ec239bb8b24c3d98cd1ad04b.css">

<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5-els.js"></script>
<![endif]-->

  </head>
  <body>
    <header class="main" id="siteheader">
  <a href="#sitenav" id="navtoggle"></a>
  <nav id="sitenav" class="container">
    <ul>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com" class="tutorials">Home</a>
      </li>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com/en/tutorials/?page=1" class="tutorials">Tutorials</a>
      </li>
      <li id="updates_menu">
        <a href="http://www.html5rocks.com/en/updates" class="updates">Updates</a>
      </li>
      <li id="contrib_menu">
        <a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
      </li>
      <li id="slides_menu">
        <a href="http://www.html5rocks.com/en/slides" class="slides">Slides</a>
      </li>
      <li id="resources_menu">
        <a href="http://www.html5rocks.com/en/resources" class="resources">Resources</a>
      </li>
    </ul>
  </nav>
</header>

    <div class="body-content">
      <section class="banner">
        <section class="container">
          <a href="/" class="watermark"></a>
          <h1>Screensharing with WebRTC</h1>
          
        </section>
      </section>
      <article class="content-wrapper article">
<div class="container">
  <section class="byline clearfix">
    <section class="author-images">
      
        
<!-- TODO: change image address.-->

<img src="http://www.html5rocks.com/static/images/profiles/dutton.png"
     alt="Sam Dutton"
     title="Sam Dutton"
     width="60" height="60"
     class="avatar">



      
    </section>
    <section class="meta">
      <div class="authors">
          
    
    <!-- TODO: change link. -->
    <strong>By</strong> <a href="http://www.html5rocks.com/profiles/#dutton">
      Sam Dutton
    </a> 
  

      </div>
      <div class="published">
        <time pubdate=""><strong>Published:</strong> December 24, 2012</time>
      </div>
      <div class="updated">
        <time><strong>Updated:</strong> December 24, 2012</time>
      </div>
      <div class="comments">
        <span><strong>Comments:</strong> <a href="#disqus_thread" class="load-comments" data-disqus-identifier="http://updates.html5rocks.com/2012/12/Screensharing-with-WebRTC">0</a></span>
      </div>
      <div id="notcompatible" class="hidden">
        Your browser may not support the functionality in this article.
      </div>
    </section>
  </section>
  <section class="content">
    <p><a href="http://updates.html5rocks.com/2012/12/WebRTC-hits-Firefox-Android-and-iOS">As we reported last week</a>, there's been a <strong>lot</strong> happening lately with our old friend <a href="http://www.html5rocks.com/en/tutorials/webrtc/basics/">WebRTC</a>.</p>

<p>Well... here's another first: WebRTC screensharing.</p>

<p><a href="https://www.youtube.com/watch?v=tD0QtBUZsF4" title="Linked to screencast of WebRTC screensharing in action. Screengrab image shows WebRTC screensharing extension, featuring Jake Archibald, Peter Beverloo, Paul Lewis and Sam Dutton."><img src="http://www.samdutton.com/rtcshare.jpg" alt="Screengrab of WebRTC screensharing extension, featuring Jake Archibald, Peter Beverloo, Paul Lewis and Sam Dutton" style="width: 100%" /></a></p>

<p>Here's a screencast: <a href="https://www.youtube.com/watch?v=tD0QtBUZsF4" title="Video on YouTube: screencast of WebRTC screensharing in action">youtube.com/watch?v=tD0QtBUZsF4</a></p>

<p>...and here's the code: <a href="https://www.github.com/samdutton/rtcshare" title="Github code repository for WebRTC screensharing extension">github.com/samdutton/rtcshare</a></p>

<p>In essence, we've built an experimental Chrome extension that uses <code>RTCPeerConnection</code> and <a href="http://developer.chrome.com/dev/extensions/tabCapture.html" title="chrome.tabCapture API documentation"><code>chrome.tabCapture</code></a> to share a live 'video' of a browser tab. If you want to try it out, you'll need <a href="https://tools.google.com/dlpage/chromesxs/">Chrome Canary</a>, and you'll need to enable Experimental Extension APIs on the <em>about:flags</em> page.</p>

<p>Our prototype relies heavily on the mighty <a href="http://apprtc.appspot.com">apprtc.appspot.com</a> demo and, to be frank, it's a bit of a hack! But... it's a proof of concept, and it works.</p>

<p>Here's how we did it:</p>

<ol>

<li><p>When the user clicks the extension icon (the 'record button' next to the address bar), the extension's background script <em>background.js</em>, appends an iframe to itself, the <code>src</code> of which is <a href="https://rtcshare.appspot.com">rtcshare.appspot.com</a>. In <em>background.js</em> it's only used to get values such as <code>token</code> and <code>room_key</code>. We told you this was a hack :^}! This is a chopped and channeled version of <a href="http://apprtc.appspot.com">apprtc.appspot.com</a>. As with the apprtc example, <a href="https://rtcshare.appspot.com">rtcshare.appspot.com</a> is also used for the remote client. </p></li>


<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tab</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">currentMode</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">[</span><span class="s2">&quot;capturing&quot;</span><span class="p">];</span>
	<span class="kd">var</span> <span class="nx">newMode</span> <span class="o">=</span> <span class="nx">currentMode</span> <span class="o">===</span> <span class="s2">&quot;on&quot;</span> <span class="o">?</span> <span class="s2">&quot;off&quot;</span> <span class="o">:</span> <span class="s2">&quot;on&quot;</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">newMode</span> <span class="o">===</span> <span class="s2">&quot;on&quot;</span><span class="p">){</span> <span class="c1">// start capture</span>
		<span class="nx">appendIframe</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// stop capture</span>
		<span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">getSelected</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tab</span><span class="p">){</span>
			<span class="nx">localStream</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
			<span class="nx">onRemoteHangup</span><span class="p">();</span>
		<span class="p">});</span>
		<span class="c1">// set icon, localStorage, etc.</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>


<li><p>When the iframe has loaded, <em>background.js</em> gets values from it (generated by the rtcshare.appspot.com app) and calls <code>chrome.tabCapture.capture()</code> to start capturing a live stream of the current tab.</p></li>


<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">appendIframe</span><span class="p">(){</span>
	<span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;iframe&quot;</span><span class="p">);</span>
	<span class="nx">iframe</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://rtcshare.appspot.com&quot;</span><span class="p">;</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
	<span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
		<span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&quot;sendConfig&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
	<span class="p">};</span>
<span class="p">}</span>

<span class="c1">// serialised config object messaged by iframe when it loads</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="s2">&quot;https://rtcshare.appspot.com&quot;</span><span class="p">){</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
 	<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
	<span class="nx">room_link</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">room_link</span><span class="p">;</span> <span class="c1">// the remote peer URL</span>
	<span class="nx">token</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span> <span class="c1">// for messaging via Channel API</span>
	<span class="c1">// more parameter set from config</span>
<span class="p">);</span>

<span class="kd">function</span> <span class="nx">startCapture</span><span class="p">(){</span>
	<span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">getSelected</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tab</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">selectedTabId</span> <span class="o">=</span> <span class="nx">tab</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
		<span class="nx">chrome</span><span class="p">.</span><span class="nx">tabCapture</span><span class="p">.</span><span class="nx">capture</span><span class="p">({</span><span class="nx">audio</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">video</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="nx">handleCapture</span><span class="p">);</span> <span class="c1">// bingo!</span>
	<span class="p">});</span>
<span class="p">}</span></code></pre></div>


<li><p>Once the live stream is available (in other words, a live 'video' of the current tab), <em>background.js</em> kicks off the peer connection process, and signalling is done via <a href="http://www.rtcshare.appspot.com">rtcshare.appspot.com</a> using XHR and Google's <a href="https://developers.google.com/appengine/docs/python/channel/overview">Channel API</a>. All in all, it works like the <a href="http://www.apprtc.appspot.com">apprtc</a> demo, except that the video stream communicated to the remote peer is from <code>chrome.tabCapture</code> and not <code>getUserMedia()</code>.</p></li>


<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">handleCapture</span><span class="p">(</span><span class="nx">stream</span><span class="p">){</span>
	<span class="nx">localStream</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">;</span> <span class="c1">// used by RTCPeerConnection addStream();</span>
	<span class="nx">initialize</span><span class="p">();</span> <span class="c1">// start signalling and peer connection process</span>
<span class="p">}</span></code></pre></div>


<li><p>For demo purposes, this prototype extension opens a new tab with the URL provided by <a href="https://rtcshare.appspot.com">rtcshare.appspot.com</a>, which has a 'room number' query string added. Of course, this URL could be opened on another computer, in another place, and THAT might be the start of something useful!</p></li>


<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="nx">room_link</span><span class="p">});</span></code></pre></div>


</ol>

<p>We envisage a lot of interesting use cases for screensharing and, even at this early stage of development, we're impressed at how responsive and stable plugin-free tab capture and sharing can be.</p>

<p>As ever, we welcome your comments: about this extension and about the WebRTC APIs in general. If you want to learn more about WebRTC, check out the <a href="http://www.html5rocks.com/en/tutorials/webrtc/basics/">HTML5 Rocks article</a> or our <a href="https://docs.google.com/document/d/1idl_NYQhllFEFqkGQOLv8KBK8M3EVzyvxnKkHl4SuM8/edit">Quick Start Guide</a>.</p>

<p>Happy hacking -- and best wishes for 2013 from everyone at HTML5R and WebRTC!</p>

  </section>
  <section>
    <!-- TODO: Update link. -->
    
      <a href="/tag/chrome APIs" class="tag">chrome APIs</a>
    
      <a href="/tag/getusermedia" class="tag">getusermedia</a>
    
      <a href="/tag/Chrome extensions" class="tag">Chrome extensions</a>
    
      <a href="/tag/screenshare" class="tag">screenshare</a>
    
      <a href="/tag/webrtc" class="tag">webrtc</a>
    
  </section>
  <div class="pager">
    
    <a href="/2012/12/Canvas-driven-background-images">&laquo; Canvas-driven background images</a>
     | 
    <a href="/2013/01/Voice-Driven-Web-Apps-Introduction-to-the-Web-Speech-API">Voice Driven Web Apps: Introduction to the Web Speech API &raquo;</a>
    
  </div>
</div>
</article>
<section class="disqus pattern-bg-lighter">
  <div id="disqus" class="container">
    <h2>Comments</h2>
    <div id="disqus_thread">
      <a href="#disqus_thread" class="load-comments"
          data-disqus-identifier="http://updates.html5rocks.com/2012/12/Screensharing-with-WebRTC">0</a>
    </div>
  </div>

  <noscript>
    <p class="center">
      <strong>
        <a href="http://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a>
      </strong>
    </p>
  </noscript>

  <script>

    var disqus_shortname = 'html5rocks';
    var disqus_identifier = 'http://updates.html5rocks.com/2012/12/Screensharing-with-WebRTC';
    var disqus_url = 'http://updates.html5rocks.com/2012/12/Screensharing-with-WebRTC';
    var disqus_developer = 0;

    var disqus_config = function () {
      var funky_language_code_mapping = {
        'de': 'de_inf',
        'es': 'es_ES',
        'pt': 'pt_EU',
        'sr': 'sr_CYRL',
        'sv': 'sv_SE',
        'zh': 'zh_HANT'
      };
      this.language = funky_language_code_mapping['en'] ||
                      'en';

      this.callbacks.onReady = [ function () {
                                    try {
                                      ga('send', 'event', 'View comments');
                                    } catch(err){}
                                 } ];
      this.callbacks.onNewComment = [ function (comment) {
                                        try {
                                          ga('send', 'event', 'Commented');
                                        } catch(err){}
                                      } ];
    };

    window.addEventListener('load', function(e) {

      var c = document.createElement('script');
      c.type = 'text/javascript';
      c.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      c.async = true;

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      sp.insertBefore(c, s);

      if (window.location.hash === '#disqus_thread')
        loadComments();

    }, false);

    var disqus_loaded = false;
    function loadComments() {

      if (disqus_loaded)
        return;

      disqus_loaded = true;

      ga('send', 'event', 'Interactions', 'Comments', 'Comments Loaded');

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;

      var disqusContainer = document.getElementById('disqus');
      disqusContainer.classList.add('active');

      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      sp.insertBefore(dsq, s);
    }
    var loadCommentsButtons = document.querySelectorAll('.load-comments');
    for(var l = 0; l < loadCommentsButtons.length; l++)
      loadCommentsButtons[l].addEventListener('click', loadComments);

  </script>
</section>



    </div>
    <footer>
  <div class="container">
    
    <h1>Next steps</h1>
    <aside class="panel share">
      <h2>Share</h2>
        <a href="https://twitter.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/&amp;text=Getting Started with CSS Shapes&amp;lang=en&amp;via=ChromiumDev&amp;related=ChromiumDev" class="twitter" target="_blank">Twitter</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="facebook" target="_blank">Facebook</a>
        <a href="https://plus.google.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="gplus" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">Google+</a>
    </aside>
    <aside class="panel rss">
      <h2>Subscribe</h2>
      <p>Enjoyed this article? Grab the <a href="http://feeds.feedburner.com/html5rocks">RSS feed</a> and stay up-to-date.</p>
    </aside>
    
    <p class="licensing">
      Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
    </p>
  </div>
</footer>


    <script>
      (function() {

        var siteHeader = document.getElementById('siteheader');
        var navToggle = document.getElementById('navtoggle');
        var siteNav = document.getElementById('sitenav');

        navToggle.addEventListener('click', function(e) {
          siteNav.classList.toggle('active');
          e.preventDefault();
        });

      })();
    </script>

    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create','UA-15028909-7','auto');
      ga('create','UA-49880327-4','auto',{'name':'html5rocks'});
      ga('send','pageview');
      ga('html5rocks.send','pageview');
    </script>
  </body>
</html>
