<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta property="twitter:account_id" content="1593210261" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A resource for developers looking to put HTML5 to use today, including information on specific features and when to use them in your apps.">
<meta name="keywords" content="html5,html 5,html5 demos,html5 examples,javascript,css3,notifications,geolocation,web workers,apppcache,file api,filereader,indexeddb,offline,audio,video,drag and drop,chrome,sse,mobile">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="E1HOIDkksrWY5npenL8FeQhKn4Ujctd75iO2lfufSyA" />
<title>Introduction to Custom Filters (aka CSS Shaders)</title>

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="  /assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png">
<meta name="theme-color" content="#3372DF">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="HTML5 Rocks">
<link rel="apple-touch-icon-precomposed" href="/assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png
">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/assets/HTML5_Badge_144-ddcf1cea1a1204b1733041733d66f76a.png
">
<meta name="msapplication-TileColor" content="#3372DF">

<!-- TODO: consider rel=canonical -->
<!-- TODO: consider rel=publisher -->
<link rel="alternate" type="application/rss+xml" title="HTML5 Rocks RSS" href="http://feeds.feedburner.com/html5rocks">
<link rel="publisher" href="https://plus.google.com/+GoogleChromeDevelopers">




  




<link href="//fonts.googleapis.com/css?family=Open+Sans:600,800|Source+Code+Pro" rel="stylesheet">
<link rel="stylesheet" href="/assets/main-8dae1b06ec239bb8b24c3d98cd1ad04b.css">

<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5-els.js"></script>
<![endif]-->

  </head>
  <body>
    <header class="main" id="siteheader">
  <a href="#sitenav" id="navtoggle"></a>
  <nav id="sitenav" class="container">
    <ul>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com" class="tutorials">Home</a>
      </li>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com/en/tutorials/?page=1" class="tutorials">Tutorials</a>
      </li>
      <li id="updates_menu">
        <a href="http://www.html5rocks.com/en/updates" class="updates">Updates</a>
      </li>
      <li id="contrib_menu">
        <a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
      </li>
      <li id="slides_menu">
        <a href="http://www.html5rocks.com/en/slides" class="slides">Slides</a>
      </li>
      <li id="resources_menu">
        <a href="http://www.html5rocks.com/en/resources" class="resources">Resources</a>
      </li>
    </ul>
  </nav>
</header>

    <div class="body-content">
      <section class="banner">
        <section class="container">
          <a href="/" class="watermark"></a>
          <h1>Introduction to Custom Filters (aka CSS Shaders)</h1>
          
        </section>
      </section>
      <article class="content-wrapper article">
<div class="container">
  <section class="byline clearfix">
    <section class="author-images">
      
        
<!-- TODO: change image address.-->

<img src="http://www.html5rocks.com/static/images/profiles/paullewis.png"
     alt="Paul Lewis"
     title="Paul Lewis"
     width="60" height="60"
     class="avatar">



      
    </section>
    <section class="meta">
      <div class="authors">
          
    
    <!-- TODO: change link. -->
    <strong>By</strong> <a href="http://www.html5rocks.com/profiles/#paullewis">
      Paul Lewis
    </a> 
  

      </div>
      <div class="published">
        <time pubdate=""><strong>Published:</strong> March 25, 2013</time>
      </div>
      <div class="updated">
        <time><strong>Updated:</strong> March 25, 2013</time>
      </div>
      <div class="comments">
        <span><strong>Comments:</strong> <a href="#disqus_thread" class="load-comments" data-disqus-identifier="http://updates.html5rocks.com/2013/03/Introduction-to-Custom-Filters-aka-CSS-Shaders">0</a></span>
      </div>
      <div id="notcompatible" class="hidden">
        Your browser may not support the functionality in this article.
      </div>
    </section>
  </section>
  <section class="content">
    <h1>TL;DR</h1>

<p>Custom Filters, or CSS Shaders as they used to be called, allow you to use the power of WebGL's shaders with your DOM content. Since in the current implementation the shaders used are virtually the same as those in WebGL, you need to take a step back and understand some 3D terminology and a little bit of the graphics pipeline.</p>

<div class="video-container"><iframe src="//www.youtube.com/embed/WmwZqVFLRoA?feature=player_detailpage " frameborder="0" allowfullscreen=""></iframe></div>

<p>I've included a recorded version of a presentation I recently delivered to LondonJS. In the video I step through an overview of the 3D terminology you need to understand, what the different variable types are that you'll encounter, and how you can start playing with Custom Filters today. You should also <a href="http://goo.gl/e3KMp">grab the slides</a> so you can play with the demos yourself.</p>

<h1>Introduction to Shaders</h1>

<p>I've previously written an <a href="http://www.html5rocks.com/en/tutorials/webgl/shaders/">introduction to shaders</a> which will give you a good breakdown of what shaders are and how you can use them from a WebGL point of view. If you've never dealt with shaders it's something of a required read before you go much further, because many of the Custom Filters concepts and language hinges on the existing WebGL shader terminology.</p>

<p>So with that said, let's enable Custom Filters and plough on!</p>

<h1>Enabling Custom Filters</h1>

<p>Custom Filters are available in both Chrome and Canary as well as Chrome for Android. Simply head over to <code>about:flags</code> and search for "CSS Shaders", enable them and restart the browser. Now you're good to go!</p>

<h1>The syntax</h1>

<p>Custom Filters expands on the set of filters that you can already apply, like <code>blur</code> or <code>sepia</code>, to your DOM elements. Eric Bidelman wrote a great <a href="http://html5-demos.appspot.com/static/css/filters/index.html">playground tool</a> for those, which you should check out.</p>

<p>To apply a Custom Filter to a DOM element you use the following syntax:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.customShader</span> <span class="p">{</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">filter</span><span class="o">:</span>

    <span class="n">custom</span><span class="p">(</span>
      <span class="sx">url(vertexshader.vert)</span>
      <span class="k">mix</span><span class="p">(</span><span class="sx">url(fragment.frag)</span> <span class="k">normal</span> <span class="n">source</span><span class="o">-</span><span class="n">atop</span><span class="p">)</span><span class="o">,</span>

    <span class="c">/* Row, columns - the vertices are made automatically */</span>
    <span class="m">4</span> <span class="m">5</span><span class="o">,</span>

    <span class="c">/* We set uniforms; we can&#39;t set attributes */</span>
    <span class="n">time</span> <span class="m">0</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>You'll see from this that we declare our vertex and fragment shaders, the number of rows and columns we want our DOM element to get broken down into, and then any uniforms we want to pass through.</p>

<p>A final thing to point out here is that we use the <code>mix()</code> function around the fragment shader with a blend mode (<code>normal</code>), and a composite mode (<code>source-atop</code>). Let's take a look at the fragment shader itself to see why we even need a <code>mix()</code> function.</p>

<h1>Pixel Pushing</h1>

<p>If you're familiar with WebGL's shaders you'll notice that in Custom Filters things are a little different. For one we don't create the texture(s) that our fragment shader uses to fill in the pixels. Rather the DOM content that has the filter applied gets mapped to a texture automatically, and that means two things:</p>

<ol>
<li>For security reasons we can't query individual pixel color values of the DOM's texture</li>
<li>We don't (at least in current implementations) set the final pixel color ourselves, i.e. <code>gl_FragColor</code> is off limits. Rather, it's assumed that you will want to render the DOM content, and what you get to do is manipulate its pixels indirectly through <code>css_ColorMatrix</code> and <code>css_MixColor</code>.</li>
</ol>

<p>That means our Hello World of fragment shaders looks more like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">void</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">css_ColorMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                         <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                         <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                         <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>

  <span class="nx">css_MixColor</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

  <span class="c1">// umm, where did gl_FragColor go?</span>
<span class="p">}</span></code></pre></div>

<p>Each pixel of the DOM content is multiplied by the <code>css_ColorMatrix</code>, which in the above case does nothing as its the <a href="http://en.wikipedia.org/wiki/Identity_matrix">identity matrix</a> and changes none of the RGBA values. If we did want to, say, just keep the red values we would use a <code>css_ColorMatrix</code> like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// keep only red and alpha</span>
<span class="nx">css_ColorMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                       <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span></code></pre></div>

<p>You can hopefully see that as you multiply the 4D (RGBA) pixel values by the matrix that you get a manipulated pixel value out of the other side, and in this case one that zeros out the green and blue components.</p>

<p>The <code>css_MixColor</code> is mainly used as a base color that you want to, well, mix in with your DOM content. The mixing is done through the blend modes that you'll be familiar with from art packages: overlay, screen, color dodge, hard light and so on.</p>

<p>There are plenty of ways that these two variables can manipulate the pixels, and included in <a href="http://goo.gl/e3KMp">my presentation</a> is a <a href="http://aerotwist.com/presentations/custom-filters/demos/demo2.html">demo that you can play around with</a>. You should check out the <a href="https://dvcs.w3.org/hg/FXTF/raw-file/tip/filters/index.html#shader-processing-model">Custom Filters specification</a> to get a better handle on how the blend and composite modes interact.</p>

<h1>Vertex Creation</h1>

<p>In WebGL we take full responsibility for the creation of our mesh's 3D points, but in Custom Filters all you have to do is specify the number of rows and columns that you want and the browser will automatically break down your DOM content into a bunch of triangles:</p>

<p><figure><img src="http://www.html5rocks.com/static/images/updates/custom-filters/rowscols.png" alt="Vertex creation" />
<figcaption>An image being broken down into rows and columns</figcaption>
</figure>
</p>

<p>Each one of those vertices then gets passed through to our vertex shader for manipulation, and that means we can start moving them around in 3D space as we need. It's not long before you can make some pretty crazy effects!</p>

<p><figure><img src="http://www.html5rocks.com/static/images/updates/custom-filters/weird.jpg" alt="An accordion effect" />
<figcaption>An image being warped by an accordion effect</figcaption>
</figure></p>

<h1>Animating with Shaders</h1>

<p>Bringing in animations to your shaders is what makes them fun and engaging. To do that you simply use a transition (or animation) in your CSS to update uniform values:</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.shader</span> <span class="p">{</span>
  <span class="c">/* transition on the filter property */</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transition</span><span class="o">:</span> <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">filter</span> <span class="m">2500</span><span class="n">ms</span> <span class="n">ease</span><span class="o">-</span><span class="n">out</span><span class="p">;</span>

  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">filter</span><span class="o">:</span> <span class="n">custom</span><span class="p">(</span>
    <span class="sx">url(vshader.vert)</span>
    <span class="k">mix</span><span class="p">(</span><span class="sx">url(fshader.frag)</span> <span class="k">normal</span> <span class="n">source</span><span class="o">-</span><span class="n">atop</span><span class="p">)</span><span class="o">,</span>
    <span class="m">1</span> <span class="m">1</span><span class="o">,</span>
    <span class="n">time</span> <span class="m">0</span><span class="p">);</span>
<span class="p">}</span>

 <span class="nc">.shader</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">filter</span><span class="o">:</span> <span class="n">custom</span><span class="p">(</span>
    <span class="sx">url(vshader.vert)</span>
    <span class="k">mix</span><span class="p">(</span><span class="sx">url(fshader.frag)</span> <span class="k">normal</span> <span class="n">source</span><span class="o">-</span><span class="n">atop</span><span class="p">)</span><span class="o">,</span>
    <span class="m">1</span> <span class="m">1</span><span class="o">,</span>
    <span class="n">time</span> <span class="m">1</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>So the thing to notice in the code above is that time is going to ease from <code>0</code> to <code>1</code> during the transition. Inside the shader we can declare the uniform <code>time</code> and use whatever its current value is:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">uniform</span> <span class="kr">float</span> <span class="nx">time</span><span class="p">;</span>

<span class="nx">uniform</span> <span class="nx">mat4</span> <span class="nx">u_projectionMatrix</span><span class="p">;</span>
<span class="nx">attribute</span> <span class="nx">vec4</span> <span class="nx">a_position</span><span class="p">;</span>

<span class="k">void</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// copy a_position to position - attributes are read only!</span>
  <span class="nx">vec4</span> <span class="nx">position</span> <span class="o">=</span> <span class="nx">a_position</span><span class="p">;</span>

  <span class="c1">// use our time uniform from the CSS declaration</span>
  <span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">time</span><span class="p">;</span>

  <span class="nx">gl_Position</span> <span class="o">=</span> <span class="nx">u_projectionMatrix</span> <span class="o">*</span> <span class="nx">position</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h1>Get Playing!</h1>

<p>Custom Filters are great fun to play with, and the amazing effects you can create are difficult (and in some cases impossible) without them. It is still early days, and things are changing quite a bit, but adding them will add a little bit of showbiz to your projects, so why not give them a go?</p>

<h1>Additional Resources</h1>

<ul>
<li><a href="https://github.com/WebGLTools/GL-Shader-Validator">GL Shader Validator</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/webgl/shaders/">Intro to Shaders</a></li>
<li><a href="http://alteredqualia.com/css-shaders/article/">Getting Started with CSS Custom Filters</a></li>
<li><a href="http://learningwebgl.com/blog/?page_id=1217">Learning WebGL</a></li>
<li><a href="http://html.adobe.com/webstandards/csscustomfilters/cssfilterlab/">Adobe CSS Filter Lab</a></li>
</ul>

  </section>
  <section>
    <!-- TODO: Update link. -->
    
      <a href="/tag/webgl" class="tag">webgl</a>
    
      <a href="/tag/shaders" class="tag">shaders</a>
    
      <a href="/tag/css" class="tag">css</a>
    
      <a href="/tag/filters" class="tag">filters</a>
    
  </section>
  <div class="pager">
    
    <a href="/2013/03/What-s-the-CSS-scope-pseudo-class-for">&laquo; What's the CSS :scope pseudo-class for?</a>
     | 
    <a href="/2013/06/sourceMappingURL-and-sourceURL-syntax-changed">sourceMappingURL and sourceURL syntax changed &raquo;</a>
    
  </div>
</div>
</article>
<section class="disqus pattern-bg-lighter">
  <div id="disqus" class="container">
    <h2>Comments</h2>
    <div id="disqus_thread">
      <a href="#disqus_thread" class="load-comments"
          data-disqus-identifier="http://updates.html5rocks.com/2013/03/Introduction-to-Custom-Filters-aka-CSS-Shaders">0</a>
    </div>
  </div>

  <noscript>
    <p class="center">
      <strong>
        <a href="http://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a>
      </strong>
    </p>
  </noscript>

  <script>

    var disqus_shortname = 'html5rocks';
    var disqus_identifier = 'http://updates.html5rocks.com/2013/03/Introduction-to-Custom-Filters-aka-CSS-Shaders';
    var disqus_url = 'http://updates.html5rocks.com/2013/03/Introduction-to-Custom-Filters-aka-CSS-Shaders';
    var disqus_developer = 0;

    var disqus_config = function () {
      var funky_language_code_mapping = {
        'de': 'de_inf',
        'es': 'es_ES',
        'pt': 'pt_EU',
        'sr': 'sr_CYRL',
        'sv': 'sv_SE',
        'zh': 'zh_HANT'
      };
      this.language = funky_language_code_mapping['en'] ||
                      'en';

      this.callbacks.onReady = [ function () {
                                    try {
                                      ga('send', 'event', 'View comments');
                                    } catch(err){}
                                 } ];
      this.callbacks.onNewComment = [ function (comment) {
                                        try {
                                          ga('send', 'event', 'Commented');
                                        } catch(err){}
                                      } ];
    };

    window.addEventListener('load', function(e) {

      var c = document.createElement('script');
      c.type = 'text/javascript';
      c.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      c.async = true;

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      sp.insertBefore(c, s);

      if (window.location.hash === '#disqus_thread')
        loadComments();

    }, false);

    var disqus_loaded = false;
    function loadComments() {

      if (disqus_loaded)
        return;

      disqus_loaded = true;

      ga('send', 'event', 'Interactions', 'Comments', 'Comments Loaded');

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;

      var disqusContainer = document.getElementById('disqus');
      disqusContainer.classList.add('active');

      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      sp.insertBefore(dsq, s);
    }
    var loadCommentsButtons = document.querySelectorAll('.load-comments');
    for(var l = 0; l < loadCommentsButtons.length; l++)
      loadCommentsButtons[l].addEventListener('click', loadComments);

  </script>
</section>



    </div>
    <footer>
  <div class="container">
    
    <h1>Next steps</h1>
    <aside class="panel share">
      <h2>Share</h2>
        <a href="https://twitter.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/&amp;text=Getting Started with CSS Shapes&amp;lang=en&amp;via=ChromiumDev&amp;related=ChromiumDev" class="twitter" target="_blank">Twitter</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="facebook" target="_blank">Facebook</a>
        <a href="https://plus.google.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="gplus" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">Google+</a>
    </aside>
    <aside class="panel rss">
      <h2>Subscribe</h2>
      <p>Enjoyed this article? Grab the <a href="http://feeds.feedburner.com/html5rocks">RSS feed</a> and stay up-to-date.</p>
    </aside>
    
    <p class="licensing">
      Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
    </p>
  </div>
</footer>


    <script>
      (function() {

        var siteHeader = document.getElementById('siteheader');
        var navToggle = document.getElementById('navtoggle');
        var siteNav = document.getElementById('sitenav');

        navToggle.addEventListener('click', function(e) {
          siteNav.classList.toggle('active');
          e.preventDefault();
        });

      })();
    </script>

    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create','UA-15028909-7','auto');
      ga('create','UA-49880327-4','auto',{'name':'html5rocks'});
      ga('send','pageview');
      ga('html5rocks.send','pageview');
    </script>
  </body>
</html>
