<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta property="twitter:account_id" content="1593210261" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A resource for developers looking to put HTML5 to use today, including information on specific features and when to use them in your apps.">
<meta name="keywords" content="html5,html 5,html5 demos,html5 examples,javascript,css3,notifications,geolocation,web workers,apppcache,file api,filereader,indexeddb,offline,audio,video,drag and drop,chrome,sse,mobile">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What's the CSS :scope pseudo-class for?</title>

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="  /assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="HTML5 Rocks">
<link rel="apple-touch-icon-precomposed" href="/assets/HTML5_Badge_192-f9389f6cad587f357d82be791970c8ad.png
">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/assets/HTML5_Badge_144-ddcf1cea1a1204b1733041733d66f76a.png
">
<meta name="msapplication-TileColor" content="#3372DF">

<!-- TODO: consider rel=canonical -->
<!-- TODO: consider rel=publisher -->
<link rel="alternate" type="application/rss+xml" title="HTML5 Rocks RSS" href="http://feeds.feedburner.com/html5rocks">
<link rel="publisher" href="https://plus.google.com/+GoogleChromeDevelopers">




  




<link href="//fonts.googleapis.com/css?family=Open+Sans:600,800|Source+Code+Pro" rel="stylesheet">
<link rel="stylesheet" href="/assets/main-8dae1b06ec239bb8b24c3d98cd1ad04b.css">

<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5-els.js"></script>
<![endif]-->

  </head>
  <body>
    <header class="main" id="siteheader">
  <a href="#sitenav" id="navtoggle"></a>
  <nav id="sitenav" class="container">
    <ul>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com" class="tutorials">Home</a>
      </li>
      <li id="tutorials_menu">
        <a href="http://www.html5rocks.com/en/tutorials/?page=1" class="tutorials">Tutorials</a>
      </li>
      <li id="updates_menu">
        <a href="http://www.html5rocks.com/en/updates" class="updates">Updates</a>
      </li>
      <li id="contrib_menu">
        <a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md" target="_blank">Contribute</a>
      </li>
      <li id="slides_menu">
        <a href="http://www.html5rocks.com/en/slides" class="slides">Slides</a>
      </li>
      <li id="resources_menu">
        <a href="http://www.html5rocks.com/en/resources" class="resources">Resources</a>
      </li>
    </ul>
  </nav>
</header>

    <div class="body-content">
      <section class="banner">
        <section class="container">
          <a href="/en/" class="watermark"></a>
          <h1>What's the CSS :scope pseudo-class for?</h1>
          
        </section>
      </section>
      <article class="content-wrapper article">
<div class="container">
  <section class="byline clearfix">
    <section class="author-images">
      
        
<!-- TODO: change image address.-->

<img src="http://www.html5rocks.com/static/images/profiles/ericbidelman.png"
     alt="Eric Bidelman"
     title="Eric Bidelman"
     width="60" height="60"
     class="avatar">



      
    </section>
    <section class="meta">
      <div class="authors">
          
    
    <!-- TODO: change link. -->
    <strong>By</strong> <a href="http://www.html5rocks.com/profiles/#ericbidelman">
      Eric Bidelman
    </a> 
  

      </div>
      <div class="published">
        <time pubdate=""><strong>Published:</strong> March 22, 2013</time>
      </div>
      <div class="updated">
        <time><strong>Updated:</strong> March 22, 2013</time>
      </div>
      <div class="comments">
        <span><strong>Comments:</strong> <a href="#disqus_thread" class="load-comments" data-disqus-identifier="http://html5rocks.com/updates//2013/03/What-s-the-CSS-scope-pseudo-class-for"></a></span>
      </div>
      <div id="notcompatible" class="hidden">
        Your browser may not support the functionality in this article.
      </div>
    </section>
  </section>
  <section class="content">
    <p><code>:scope</code> is defined in <a href="http://www.w3.org/TR/selectors4/#scope-pseudo">CSS Selectors 4</a> as:</p>

<blockquote>
  <p>A pseudo-class which represents any element that is in the contextual reference element set. This is is a (potentially empty) explicitly-specified set of elements, such as that specified by the <code>querySelector()</code>, or the parent element of a <code>&lt;style scoped&gt;</code> element, which is used to “scope” a selector so that it only matches within a subtree.</p>
</blockquote>

<p>An example of using this guy is within a <code>&lt;style scoped&gt;</code> (<a href="http://updates.html5rocks.com/2012/03/A-New-Experimental-Feature-style-scoped">more info</a>):</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;style&gt;</span>
  <span class="nt">li</span> <span class="p">{</span>
    <span class="k">color</span><span class="o">:</span> <span class="nb">blue</span><span class="p">;</span>
  <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;style </span><span class="na">scoped</span><span class="nt">&gt;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nd">:scope</span> <span class="p">{</span>
      <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">red</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;li&gt;</span>abc<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>def<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>efg<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>hij<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>klm<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>nop<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span></code></pre></div>

<p>Note: <code>&lt;style scoped&gt;</code> can be enabled in Chrome using the “Enable experimental WebKit features” flag in about:flags.</p>

<p>This colors the <code>li</code> elements in the first <code>ul</code> red and, because of the <code>:scope</code> rule, puts a border around the <code>ul</code>. That’s because in the context of this <code>&lt;style scoped&gt;</code>, the <code>ul</code> matches <code>:scope</code>. It’s the local context. If we were to add a <code>:scope</code> rule in the outer <code>&lt;style&gt;</code> it would match the entire document. Essentially, equivalent to <code>:root</code>.</p>

<h2 id="contextual-elements">Contextual elements</h2>

<p>You’re probably aware of the <code>Element</code> version of <code>querySelector()</code> and <code>querySelectorAll()</code>. Instead of querying the entire document, you can restrict the result set to a contextual element:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;ul&gt;</span>
 <span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">&quot;scope&quot;</span><span class="nt">&gt;&lt;a&gt;</span>abc<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
 <span class="nt">&lt;li&gt;</span>def<span class="nt">&lt;/li&gt;</span>
 <span class="nt">&lt;li&gt;&lt;a&gt;</span>efg<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;ul a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// 2</span>

  <span class="kd">var</span> <span class="nx">scope</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#scope&#39;</span><span class="p">);</span>
  <span class="nx">scope</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// 1</span>
<span class="nt">&lt;/script&gt;</span></code></pre></div>

<p>When these are called, the browser returns a <code>NodeList</code> that’s filtered to only include the set of nodes that a.) match the selector and b.) which are also descendants of the context element. So in the the second example, the browser finds all <code>a</code> elements, then filters out the ones not in the <code>scope</code> element. This works, but it can lead to some bizarre behavior if you’re not careful. Read on.</p>

<h2 id="when-queryselector-goes-wrong">When querySelector goes wrong</h2>

<p>There’s a <em>really</em> <a href="http://www.w3.org/TR/selectors-api/#examples0">important point</a> in the <a href="http://www.w3.org/TR/selectors-api/">Selectors spec</a> that people often overlook. Even when <code>querySelector[All]()</code> is invoked on an element, <strong>selectors still evaluate in the context of the entire document</strong>. This means unanticipated things can happen:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">scope</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;ul a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 1</span>
<span class="nx">scope</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;body ul a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 1</span></code></pre></div>

<p>WTF! In the first example, <code>ul</code> <em>is</em> my element, yet I’m still able to use it and matches nodes. In the second, <code>body</code> isn’t even a descendant of my element, but “<code>body ul a</code>” still matches. Both of these are confusing and not what you’d expect.</p>

<p>It’s worth making the comparison to jQuery here, which takes the right approach and does what you’d expect:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="nx">scope</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul a&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="c1">// 0</span>
<span class="nx">$</span><span class="p">(</span><span class="nx">scope</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;body ul a&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="c1">// 0</span></code></pre></div>

<p>…enter <code>:scope</code> to solve these semantic shenanigans.</p>

<h2 id="fixing-queryselector-with-scope">Fixing querySelector with :scope</h2>

<p>WebKit <a href="http://trac.webkit.org/changeset/145691">recently landed</a> support for using the <code>:scope</code> pseudo-class in <code>querySelector[All]()</code>. You can test it in Chrome Canary 27.</p>

<p>You can use it <strong>restrict selectors to a context element</strong>. Let’s see an example. In the following, <code>:scope</code> is used to “scope” the selector to the scope element’s subtree. That’s right, I said scope three times!</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">scope</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;:scope ul a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 0</span>
<span class="nx">scope</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;:scope body ul a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 0</span>
<span class="nx">scope</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;:scope a&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 1</span></code></pre></div>

<p>Using <code>:scope</code> makes the semantics of the <code>querySelector()</code> methods a little more predictable and inline with what others like jQuery are already doing.</p>

<h2 id="performance-win">Performance win?</h2>

<p>Not yet :(</p>

<p>I was curious if using <code>:scope</code> in qS/qSA gives a performance boost. So…like a good engineer I threw together a <a href="http://jsbin.com/icahoc/1/">test</a>. My rationale: less surface area for the browser to do selector matching means speedier lookups.</p>

<p>In my experiment, WebKit currently takes ~1.5-2x longer than not using <code>:scope</code>. Drats! When <a href="http://crbug.com/222028">crbug.com/222028</a> gets fixed, <strong>using it should theoretically give you a slight performance boost</strong> over not using it.</p>

  </section>
  <section>
    <!-- TODO: Update link. -->
    
      <a href="/tag/nuts_and_bolts" class="tag">nuts and bolts</a>
    
      <a href="/tag/api" class="tag">api</a>
    
      <a href="/tag/dom" class="tag">dom</a>
    
      <a href="/tag/semantics" class="tag">semantics</a>
    
      <a href="/tag/announcement" class="tag">announcement</a>
    
  </section>
  <div class="pager">
    
    <a href="/2013/03/Visualizing-Shadow-DOM-Concepts">&laquo; Visualizing Shadow DOM Concepts</a>
     | 
    <a href="/2013/03/Introduction-to-Custom-Filters-aka-CSS-Shaders">Introduction to Custom Filters (aka CSS Shaders) &raquo;</a>
    
  </div>
</div>
</article>
<section class="disqus pattern-bg-lighter">
  <div id="disqus" class="container">
    <h2>Comments</h2>
    <div id="disqus_thread">
      <a href="#disqus_thread" class="load-comments"
          data-disqus-identifier="/2013/03/What-s-the-CSS-scope-pseudo-class-for">0</a>
    </div>
  </div>

  <noscript>
    <p class="center">
      <strong>
        <a href="http://disqus.com/?ref_noscript">Please enable JavaScript to view the comments powered by Disqus.</a>
      </strong>
    </p>
  </noscript>

  <script>

    var disqus_shortname = 'html5rocks';
    var disqus_identifier = 'http://html5rocks.com/updates//2013/03/What-s-the-CSS-scope-pseudo-class-for';
    var disqus_url = 'http://html5rocks.com/updates//2013/03/What-s-the-CSS-scope-pseudo-class-for';
    var disqus_developer = 0;

    var disqus_config = function () {
      var funky_language_code_mapping = {
        'de': 'de_inf',
        'es': 'es_ES',
        'pt': 'pt_EU',
        'sr': 'sr_CYRL',
        'sv': 'sv_SE',
        'zh': 'zh_HANT'
      };
      this.language = funky_language_code_mapping['en'] ||
                      'en';

      this.callbacks.onReady = [ function () {
                                    try {
                                      ga('send', 'event', 'View comments');
                                    } catch(err){}
                                 } ];
      this.callbacks.onNewComment = [ function (comment) {
                                        try {
                                          ga('send', 'event', 'Commented');
                                        } catch(err){}
                                      } ];
    };

    window.addEventListener('load', function(e) {

      var c = document.createElement('script');
      c.type = 'text/javascript';
      c.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      c.async = true;

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      sp.insertBefore(c, s);

      if (window.location.hash === '#disqus_thread')
        loadComments();

    }, false);

    var disqus_loaded = false;
    function loadComments() {

      if (disqus_loaded)
        return;

      disqus_loaded = true;

      ga('send', 'event', 'Interactions', 'Comments', 'Comments Loaded');

      var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;

      var disqusContainer = document.getElementById('disqus');
      disqusContainer.classList.add('active');

      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      sp.insertBefore(dsq, s);
    }
    var loadCommentsButtons = document.querySelectorAll('.load-comments');
    for(var l = 0; l < loadCommentsButtons.length; l++)
      loadCommentsButtons[l].addEventListener('click', loadComments);

  </script>
</section>



    </div>
    <footer>
  <div class="container">
    
    <h1>Next steps</h1>
    <aside class="panel share">
      <h2>Share</h2>
        <a href="https://twitter.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/&amp;text=Getting Started with CSS Shapes&amp;lang=en&amp;via=ChromiumDev&amp;related=ChromiumDev" class="twitter" target="_blank">Twitter</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="facebook" target="_blank">Facebook</a>
        <a href="https://plus.google.com/share?url=http://www.html5rocks.com/tutorials/shapes/getting-started/" class="gplus" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">Google+</a>
    </aside>
    <aside class="panel rss">
      <h2>Subscribe</h2>
      <p>Enjoyed this article? Grab the <a href="http://feeds.feedburner.com/html5rocks">RSS feed</a> and stay up-to-date.</p>
    </aside>
    
    <p class="licensing">
      Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
    </p>
  </div>
</footer>


    <script>
      (function() {

        var siteHeader = document.getElementById('siteheader');
        var navToggle = document.getElementById('navtoggle');
        var siteNav = document.getElementById('sitenav');

        navToggle.addEventListener('click', function(e) {
          siteNav.classList.toggle('active');
          e.preventDefault();
        });

      })();
    </script>

    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create','UA-15028909-7','auto');
      ga('create','UA-49880327-4','auto',{'name':'html5rocks'});
      ga('send','pageview');
      ga('html5rocks.send','pageview');
    </script>
  </body>
</html>
